// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
    provider        = "prisma-client-js"
    previewFeatures = ["driverAdapters"]
}

datasource db {
    provider = "mysql"
    url      = env("DATABASE_URL")
    // Do not use foreign keys (PlanetScale does not support them)
    relationMode = "prisma"
}

model User {
    id          String        @id @default(cuid())
    username    String        @unique
    email       String        @unique
    password    String
    pixels      Pixel[]
    Transaction Transaction[]
}

model Pixel {
    id            String        @id @default(cuid())
   row   Int
   col  Int
    href          String
    price         Float
    owner         User          @relation(fields: [ownerId], references: [id])
    ownerId       String
    Transaction   Transaction?  @relation(fields: [transactionId], references: [id])
    transactionId String?
    UnderProgess  UnderProgess? @relation(fields: [underProgressId], references: [id])
    underProgressId String
    @@index([transactionId])
    @@index([ownerId])
    @@index([underProgressId])
}

model Transaction {
    id         String   @id @default(cuid())
    buyer      User     @relation(fields: [buyerId], references: [id])
    buyerId    String
    pixels     Pixel[]
    timestamp  DateTime
    amountPaid Float
    succeeded Boolean

    @@index([buyerId])
}

model UnderProgess {
    id String @default(cuid()) @id
    pixels          Pixel[]
    underProgressId String?   @unique
}
